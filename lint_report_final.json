[{"filePath":"C:\\Users\\HP\\Documents\\AI\\Singscape\\frontend\\src\\app\\api\\health\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\HP\\Documents\\AI\\Singscape\\frontend\\src\\app\\api\\separate\\[jobId]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\HP\\Documents\\AI\\Singscape\\frontend\\src\\app\\api\\separate\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\HP\\Documents\\AI\\Singscape\\frontend\\src\\app\\api\\upload\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\HP\\Documents\\AI\\Singscape\\frontend\\src\\app\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\HP\\Documents\\AI\\Singscape\\frontend\\src\\app\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\HP\\Documents\\AI\\Singscape\\frontend\\src\\app\\process\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'handleCancel' is assigned a value but never used.","line":170,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":170,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getStemIcon' is assigned a value but never used.","line":180,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":180,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useEffect, useState, useCallback } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { Music2, AlertCircle } from 'lucide-react';\r\n// ProgressBar removed as it was unused\r\nimport { ProcessingStatus, StemResult, STEM_CONFIG } from '@/types/audio';\r\nimport { audioBufferToWav } from '@/lib/audio-utils';\r\n\r\nexport default function ProcessPage() {\r\n    const router = useRouter();\r\n    const [status, setStatus] = useState<ProcessingStatus>({\r\n        stage: 'idle',\r\n        progress: 0,\r\n        message: 'Initializing...',\r\n    });\r\n    const [error, setError] = useState<string | null>(null);\r\n\r\n    const [retryCount, setRetryCount] = useState(0);\r\n\r\n    useEffect(() => {\r\n        let isCancelled = false;\r\n        let pollInterval: NodeJS.Timeout;\r\n\r\n        const runProcessing = async () => {\r\n            // Get file info from sessionStorage\r\n            const fileInfoStr = sessionStorage.getItem('audioFile');\r\n\r\n            if (!fileInfoStr) {\r\n                setError('No audio file found. Please upload a file first.');\r\n                return;\r\n            }\r\n\r\n            const fileInfo = JSON.parse(fileInfoStr);\r\n\r\n            try {\r\n                // 1. Trigger Separation\r\n                setStatus({\r\n                    stage: 'loading-model',\r\n                    progress: 5,\r\n                    message: 'Initializing Demucs model...',\r\n                    estimatedTimeRemaining: 180, // Real AI takes time\r\n                });\r\n\r\n                const startResponse = await fetch('/api/separate', {\r\n                    method: 'POST',\r\n                    headers: { 'Content-Type': 'application/json' },\r\n                    body: JSON.stringify({ fileName: fileInfo.name }),\r\n                });\r\n\r\n                if (!startResponse.ok) throw new Error('Failed to start separation job');\r\n\r\n                const { statusEndpoint } = await startResponse.json();\r\n\r\n                // 2. Poll Status\r\n                pollInterval = setInterval(async () => {\r\n                    if (isCancelled) return;\r\n\r\n                    try {\r\n                        const statusRes = await fetch(statusEndpoint);\r\n                        if (!statusRes.ok) return; // Skip this tick if network blip\r\n\r\n                        const jobStatus = await statusRes.json();\r\n\r\n                        if (jobStatus.status === 'processing' || jobStatus.status === 'starting') {\r\n                            setStatus(prev => ({\r\n                                ...prev,\r\n                                stage: 'processing',\r\n                                progress: jobStatus.progress || prev.progress, // Use reported progress or keep current\r\n                                message: jobStatus.message || 'Separating stems...',\r\n                            }));\r\n                        } else if (jobStatus.status === 'completed') {\r\n                            clearInterval(pollInterval);\r\n\r\n                            // Transform result for UI\r\n                            // backend returns { stems: { vocals: \"path/to/wav\", ... } }\r\n                            const results: StemResult[] = [];\r\n\r\n                            // We need to fetch the actual audio buffers to allow playback in the browser\r\n                            // For MVP, we might just set the URL and load buffer on play?\r\n                            // The existing StemPlayer expects 'audioBuffer'.\r\n                            // Let's Load the buffers now (might be heavy) OR refactor Player to load on demand.\r\n                            // For strict fidelity to current UI, we'll try to load them.\r\n\r\n                            setStatus({\r\n                                stage: 'exporting',\r\n                                progress: 95,\r\n                                message: 'Finalizing stems...',\r\n                            });\r\n\r\n                            const stemPaths = jobStatus.stems; // { vocals: \"path\", ... }\r\n\r\n                            // Helper to fetch and decode\r\n                            const loadStem = async (name: string, relativePath: string) => {\r\n                                const response = await fetch(`/${relativePath}`); // public folder access\r\n                                const arrayBuffer = await response.arrayBuffer();\r\n                                const audioContext = new AudioContext(); // Browser dependent\r\n                                const audioBuffer = await audioContext.decodeAudioData(arrayBuffer);\r\n                                return { name, audioBuffer, url: `/${relativePath}` };\r\n                            };\r\n\r\n                            const loadedStems = await Promise.all(\r\n                                Object.entries(stemPaths).map(([name, path]) =>\r\n                                    loadStem(name, path as string)\r\n                                )\r\n                            );\r\n\r\n                            loadedStems.forEach(stem => {\r\n                                results.push({\r\n                                    name: stem.name as StemResult['name'],\r\n                                    label: STEM_CONFIG[stem.name].label,\r\n                                    color: STEM_CONFIG[stem.name].color,\r\n                                    audioBuffer: stem.audioBuffer,\r\n                                    url: stem.url,\r\n                                    blob: audioBufferToWav(stem.audioBuffer),\r\n                                    isPlaying: false,\r\n                                    volume: 1\r\n                                });\r\n                            });\r\n\r\n                            // Store results\r\n                            const resultsData = results.map(r => ({\r\n                                name: r.name,\r\n                                label: r.label,\r\n                                color: r.color,\r\n                                url: r.url,\r\n                            }));\r\n                            sessionStorage.setItem('stemResults', JSON.stringify(resultsData));\r\n\r\n                            setStatus({\r\n                                stage: 'complete',\r\n                                progress: 100,\r\n                                message: 'Processing complete!',\r\n                            });\r\n\r\n                            if (!isCancelled) router.push('/results');\r\n                        } else if (jobStatus.status === 'failed' || jobStatus.status === 'error') {\r\n                            throw new Error(jobStatus.error || 'Job failed on backend');\r\n                        }\r\n\r\n                    } catch (pollErr) {\r\n                        console.error('Polling error', pollErr);\r\n                        // Don't fail immediately on one poll error, but maybe track consecutive failures\r\n                    }\r\n                }, 2000);\r\n\r\n            } catch (err) {\r\n                console.error('Processing error:', err);\r\n                if (!isCancelled) {\r\n                    clearInterval(pollInterval);\r\n                    setError(err instanceof Error ? err.message : 'An error occurred during processing');\r\n                    setStatus({\r\n                        stage: 'error',\r\n                        progress: 0,\r\n                        message: 'Processing failed',\r\n                        error: err instanceof Error ? err.message : 'Unknown error',\r\n                    });\r\n                }\r\n            }\r\n        };\r\n\r\n        runProcessing();\r\n\r\n        return () => {\r\n            isCancelled = true;\r\n            if (pollInterval) clearInterval(pollInterval);\r\n        };\r\n    }, [router, retryCount]);\r\n\r\n    const handleCancel = useCallback(() => {\r\n        router.push('/');\r\n    }, [router]);\r\n\r\n    const handleRetry = useCallback(() => {\r\n        setError(null);\r\n        setRetryCount(c => c + 1);\r\n    }, []);\r\n\r\n    // Map stem names to icons\r\n    const getStemIcon = (name: string) => {\r\n        switch (name) {\r\n            case 'vocals': return <Music2 className=\"w-5 h-5\" />;\r\n            case 'no_vocals': return <div className=\"w-5 h-5 border-2 border-current rounded-full\" />;\r\n            default: return <Music2 className=\"w-5 h-5\" />;\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"min-h-screen flex items-center justify-center px-4 py-20 bg-leather\" data-testid=\"process-page-container\">\r\n            <div className=\"w-full max-w-2xl relative z-10\">\r\n\r\n                {/* Rack Mount Header */}\r\n                <div className=\"bg-metal-dark p-6 rounded-t-lg border-x border-t border-[#45362C] shadow-2xl relative overflow-hidden\">\r\n                    {/* Screws */}\r\n                    <div className=\"absolute top-4 left-4 w-3 h-3 rounded-full bg-zinc-700 shadow-inner flex items-center justify-center\"><div className=\"w-full h-[1px] bg-black rotate-45\" /></div>\r\n                    <div className=\"absolute top-4 right-4 w-3 h-3 rounded-full bg-zinc-700 shadow-inner flex items-center justify-center\"><div className=\"w-full h-[1px] bg-black rotate-45\" /></div>\r\n\r\n                    <div className=\"text-center\">\r\n                        <div className=\"inline-flex items-center gap-3 mb-2 opacity-80\">\r\n                            <div className={`w-2 h-2 rounded-full ${status.stage === 'error' ? 'bg-red-500' : 'bg-green-500'} led-glow animate-pulse`} />\r\n                            <span className=\"font-mono text-xs text-[#A8977A] tracking-[0.2em] uppercase\">Processing Unit Active</span>\r\n                        </div>\r\n                        <h1 className=\"text-3xl font-bold text-[#F2E8DC] font-outfit uppercase tracking-tight\">\r\n                            signal separation\r\n                        </h1>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Rack Units (Stems) */}\r\n                <div className=\"bg-[#161711] border-x border-[#45362C]\">\r\n                    {error ? (\r\n                        <div className=\"p-12 text-center bg-red-900/20\">\r\n                            <AlertCircle className=\"w-12 h-12 text-red-500 mx-auto mb-4\" />\r\n                            <p className=\"text-red-400 font-mono mb-6\">{error}</p>\r\n                            <button onClick={handleRetry} className=\"btn-tactile px-6 py-2 text-[#161711] font-bold rounded-sm\">RETRY SEQUENCE</button>\r\n                        </div>\r\n                    ) : (\r\n                        <div className=\"divide-y divide-black\">\r\n                            {Object.entries(STEM_CONFIG).map(([key, config], index) => {\r\n                                const isActive = status.message.toLowerCase().includes(key);\r\n                                const isComplete = status.progress > (15 + (index + 1) * 20) || status.stage === 'complete';\r\n\r\n                                // Calculate needle rotation (-45 to 45 deg)\r\n                                // If complete, peg to 45. If active, wiggle around 0. If waiting, -45.\r\n                                let rotation = -45;\r\n                                if (isComplete) rotation = 45;\r\n                                else if (isActive) rotation = -10 + (Math.random() * 20) + (status.progress / 3); // Simulated movement\r\n\r\n                                return (\r\n                                    <div key={key} className=\"rack-unit p-6 flex items-center justify-between group relative\">\r\n                                        {/* Screw details */}\r\n                                        <div className=\"absolute left-2 top-1/2 -translate-y-1/2 w-2 h-2 rounded-full bg-black/50\" />\r\n                                        <div className=\"absolute right-2 top-1/2 -translate-y-1/2 w-2 h-2 rounded-full bg-black/50\" />\r\n\r\n                                        <div className=\"flex items-center gap-6 pl-6\">\r\n                                            {/* Channel Label */}\r\n                                            <div className=\"w-24\">\r\n                                                <span className=\"block text-xs text-[#A8977A]/60 font-mono uppercase tracking-widest mb-1\">Channel</span>\r\n                                                <h3 className=\"text-xl font-bold text-[#F2E8DC] uppercase\">{config.label}</h3>\r\n                                            </div>\r\n\r\n                                            {/* Status LED */}\r\n                                            <div className=\"flex flex-col items-center gap-1\">\r\n                                                <div className={`w-3 h-3 rounded-full transition-all duration-300 ${isComplete ? 'bg-green-500 led-glow' : isActive ? 'bg-amber-500 animate-pulse' : 'bg-zinc-800'}`} />\r\n                                                <span className=\"text-[9px] font-mono text-zinc-600 uppercase\">Signal</span>\r\n                                            </div>\r\n                                        </div>\r\n\r\n                                        {/* Analog VU Meter */}\r\n                                        <div className=\"relative w-32 h-16 bg-[#F2E8DC] rounded-t-lg overflow-hidden border-2 border-[#161711] shadow-inner ml-auto mr-12 opacity-90\">\r\n                                            {/* Scale markings */}\r\n                                            <div className=\"absolute bottom-0 left-[10%] w-[1px] h-3 bg-black/30 origin-bottom transform -rotate-[30deg]\" />\r\n                                            <div className=\"absolute bottom-0 left-[50%] w-[1px] h-4 bg-black/30\" />\r\n                                            <div className=\"absolute bottom-0 right-[10%] w-[1px] h-3 bg-red-500/50 origin-bottom transform rotate-[30deg]\" />\r\n                                            <span className=\"absolute top-2 right-2 text-[8px] font-bold text-red-700\">PEAK</span>\r\n\r\n                                            {/* Needle */}\r\n                                            <div\r\n                                                className=\"absolute bottom-[-2px] left-1/2 w-[2px] h-14 bg-red-600 origin-bottom needle-transition z-10\"\r\n                                                style={{ transform: `translateX(-50%) rotate(${rotation}deg)` }}\r\n                                            />\r\n                                            {/* Pivot */}\r\n                                            <div className=\"absolute bottom-[-5px] left-1/2 -translate-x-1/2 w-4 h-4 bg-black rounded-full z-20\" />\r\n                                        </div>\r\n                                    </div>\r\n                                );\r\n                            })}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Rack Footer / Global Progress */}\r\n                <div className=\"bg-metal-dark p-6 rounded-b-lg border-x border-b border-[#45362C] shadow-2xl\">\r\n                    <div className=\"flex items-center gap-4\">\r\n                        <span className=\"font-mono text-xs text-[#A8977A] uppercase w-24\">Master Out</span>\r\n                        <div className=\"flex-1 h-3 bg-black rounded-full overflow-hidden border border-zinc-700 relative\">\r\n                            {/* Striped progress bar */}\r\n                            <div\r\n                                className=\"h-full bg-amber-600 transition-all duration-300\"\r\n                                style={{ width: `${status.progress}%` }}\r\n                            />\r\n                            {/* Hatching texture overlay */}\r\n                            <div className=\"absolute inset-0 w-full h-full bg-[repeating-linear-gradient(45deg,transparent,transparent_5px,rgba(0,0,0,0.2)_5px,rgba(0,0,0,0.2)_10px)] opacity-50\" />\r\n                        </div>\r\n                        <span className=\"font-mono text-xs text-[#F2E8DC] w-10 text-right\">{Math.round(status.progress)}%</span>\r\n                    </div>\r\n                </div>\r\n\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\HP\\Documents\\AI\\Singscape\\frontend\\src\\app\\results\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\HP\\Documents\\AI\\Singscape\\frontend\\src\\components\\layout\\index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\HP\\Documents\\AI\\Singscape\\frontend\\src\\components\\ui\\FileUpload.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\HP\\Documents\\AI\\Singscape\\frontend\\src\\components\\ui\\LoginOverlay.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\HP\\Documents\\AI\\Singscape\\frontend\\src\\components\\ui\\ProgressBar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\HP\\Documents\\AI\\Singscape\\frontend\\src\\components\\ui\\SkeuomorphicHero.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\HP\\Documents\\AI\\Singscape\\frontend\\src\\components\\ui\\StemPlayer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\HP\\Documents\\AI\\Singscape\\frontend\\src\\components\\ui\\WaveformVisualizer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\HP\\Documents\\AI\\Singscape\\frontend\\src\\lib\\audio-utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\HP\\Documents\\AI\\Singscape\\frontend\\src\\types\\audio.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]